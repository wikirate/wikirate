# -*- encoding : utf-8 -*-

describe Card::Set::MetricType::Researched do
  let(:metric) { Card['Jedi+disturbances in the Force'] }

  describe '#metric_type' do
    subject { metric.metric_type }
    it { is_expected.to eq 'Researched' }
  end
  describe '#metric_type_codename' do
    subject { metric.metric_type_codename }
    it { is_expected.to eq :researched }
  end
  describe '#metric_designer' do
    subject { metric.metric_designer }
    it { is_expected.to eq 'Jedi' }
  end
  describe '#metric_designer_card' do
    subject { metric.metric_designer_card }
    it { is_expected.to eq Card['Jedi'] }
  end
  describe '#metric_title' do
    subject { metric.metric_title }
    it { is_expected.to eq 'disturbances in the Force' }
  end
  describe '#metric_title_card' do
    subject { metric.metric_title_card }
    it { is_expected.to eq Card['disturbances in the Force'] }
  end
  describe '#question_card' do
    subject { metric.question_card.name }
    it { is_expected.to eq 'Jedi+disturbances in the Force+Question'}
  end
  describe '#value_type' do
    subject { metric.value_type }
    it { is_expected.to eq 'Categorical' }
  end
  describe '#value_options' do
    subject { metric.value_options }
    it { is_expected.to eq %w(yes no) }
  end
  describe '#categorical?' do
    subject { metric.categorical? }
    it { is_expected.to be_truthy }
  end
  describe '#researched?' do
    subject { metric.researched? }
    it { is_expected.to be_truthy }
  end
  describe '#scored?' do
    subject { metric.scored? }
    it { is_expected.to be_falsey }
  end

  describe '#analysis_names' do
    subject { metric.analysis_names }
    it { is_expected.to be_empty }
    context 'when tagged with topic' do
      it 'finds related Analysis' do
         Card::Auth.as_bot do
            Card.create! name: 'Jedi+disturbances in the Force+topics',
                         content: 'Star Wars'
        end
        is_expected.to eq ['Death_Star+Star Wars']
      end
    end
  end
  describe '#companies_with_years_and_values' do
    subject { metric.companies_with_years_and_values }
    it { is_expected.to eq [ %w(Death_Star 1977 yes) ] }
  end
  describe '#random_valued_company_card' do
    subject { metric.random_valued_company_card }
    it { is_expected.to eq Card['Death_Star'] }
  end

  describe '.create' do
    it 'composes the name using the title and designer subfields' do
      Card::Auth.as_bot do
        metric = Card.create! type_id: Card::MetricID,
                              subfields: {
                                title: 'MetricTitle',
                                designer: 'MetricDesigner'
                              }
        expect(metric.name).to eq 'MetricDesigner+MetricTitle'
      end
    end
  end

  describe 'structure' do
    it 'equals golden master' do
      expect(metric.format(:html)._render_content.squish)
        .to eq GOLDEN_MASTER.strip
    end
  end

  GOLDEN_MASTER = <<-HTML
<div id="Jedi+disturbances_in_the_Force" data-card-id="2360" data-card-name="Jedi+disturbances in the Force" data-slot="{}" style="" class="card-slot content-view card-content ALL ALL_PLUS TYPE-metric METRIC_TYPE-researched LTYPE_RTYPE-basic-basic RIGHT-disturbance_in_the_force TYPE_PLUS_RIGHT-basic-disturbance_in_the_force SELF-jedi-disturbance_in_the_force"><div style="display: none"><div id="Jedi+disturbances_in_the_Force+*metric_type" data-card-id="2361" data-card-name="Jedi+disturbances in the Force+*metric type" data-slot="{&quot;home_view&quot;:&quot;titled&quot;,&quot;inc_name&quot;:&quot;+*metric type&quot;,&quot;inc_syntax&quot;:&quot;+*metric type&quot;}" style="" class="card-slot titled-view ALL ALL_PLUS TYPE-pointer RSTAR LTYPE_RTYPE-metric-basic RIGHT-Xmetric_type TYPE_PLUS_RIGHT-metric-Xmetric_type SELF-jedi-disturbance_in_the_force-Xmetric_type"><div class="menu-slot nodblclick"><div class="vertical-card-menu card-menu show-on-hover"><div class="btn-group slotter card-slot pull-right"><a rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+*metric_type?slot%5Bhome_view%5D=titled&amp;view=vertical_menu"><span class="glyphicon glyphicon-edit " aria-hidden="true"></span></a></div></div> <div class="modal fade" role="dialog" id="modal-jedi-disturbance_in_the_force-Xmetric_type"><div class="modal-dialog"><div class="modal-content"></div></div></div></div> <div class="card-header "> <div class="card-header-title "> <span class="card-title">Jedi<span class="joint">+</span>disturbances in the Force<span class="joint">+</span>*metric type</span> </div> </div> <div class="card-body card-content ALL ALL_PLUS TYPE-pointer RSTAR LTYPE_RTYPE-metric-basic RIGHT-Xmetric_type TYPE_PLUS_RIGHT-metric-Xmetric_type SELF-jedi-disturbance_in_the_force-Xmetric_type"><div class="pointer-list"><div class="pointer-item item-closed"><div id="Researched" data-card-id="1838" data-card-name="Researched" data-slot="{&quot;home_view&quot;:&quot;open&quot;}" style="" class="card-slot closed-view ALL TYPE-metric_type SELF-researched"><div class="menu-slot nodblclick"><div class="vertical-card-menu card-menu show-on-hover"><div class="btn-group slotter card-slot pull-right"><a rel="nofollow" data-remote="true" href="/Researched?slot%5Bhome_view%5D=open&amp;view=vertical_menu"><span class="glyphicon glyphicon-edit " aria-hidden="true"></span></a></div></div> <div class="modal fade" role="dialog" id="modal-researched"><div class="modal-dialog"><div class="modal-content"></div></div></div></div> <div class="card-frame panel panel-default"> <div class="card-header panel-heading"> <div class="card-header-title panel-title"> <a title="open Researched" class="open-icon toggler slotter nodblclick" data-remote="true" href="/Researched?view=open"><span class="glyphicon glyphicon-expand " aria-hidden="true"></span></a> <span class="card-title panel-title">Researched</span> </div> </div> <div class="card-body closed-content card-content ALL TYPE-metric_type SELF-researched"></div></div></div></div></div></div> </div></div> <div class="container-fluid yinyang"> <div class="row wiki"> <div class="col-md-12 metric-info "> <div class="row"> <br> <!--stuff on the right --> <div class="col-md-4 pull-right nopadding"> <div class="col-md-12 nopadding"> <div class="col-md-12 nopadding"> <div class="col-md-2 nopadding"> <h5>Tags:</h5> </div> <div class="col-md-10 nopadding"> <div id="Jedi+disturbances_in_the_Force+topics" data-card-id="null" data-card-name="Jedi+disturbances in the Force+topics" data-slot="{&quot;home_view&quot;:&quot;content&quot;,&quot;inc_name&quot;:&quot;+topics&quot;,&quot;inc_syntax&quot;:&quot;+topics|content|link&quot;,&quot;items&quot;:{&quot;view&quot;:&quot;link&quot;}}" style="" class="card-slot missing-view ALL ALL_PLUS TYPE-pointer LTYPE_RTYPE-metric-cardtype RIGHT-topic TYPE_PLUS_RIGHT-metric-topic"><a class="slotter missing-content" rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+topics?view=new">Add <span class="card-title">Jedi<span class="joint">+</span>disturbances in the Force<span class="joint">+</span>topics</span></a></div> </div> </div> <div class="col-md-4 nopadding"> <h5 class="pull-left">Unit:</h5> <h5 class="pull-left"><div id="Jedi+disturbances_in_the_Force+Unit" data-card-id="null" data-card-name="Jedi+disturbances in the Force+Unit" data-slot="{&quot;home_view&quot;:&quot;content&quot;,&quot;inc_name&quot;:&quot;+Unit&quot;,&quot;inc_syntax&quot;:&quot;+Unit|content&quot;}" style="" class="card-slot missing-view ALL ALL_PLUS TYPE-basic LTYPE_RTYPE-metric-basic RIGHT-unit TYPE_PLUS_RIGHT-metric-unit"><a class="slotter missing-content" rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+Unit?view=new">Add <span class="card-title">Jedi<span class="joint">+</span>disturbances in the Force<span class="joint">+</span>Unit</span></a></div></h5> </div> <div class="col-md-4 nopadding"> <h5 class="pull-left">Range:</h5> <h5 class="pull-left"><div id="Jedi+disturbances_in_the_Force+Range" data-card-id="null" data-card-name="Jedi+disturbances in the Force+Range" data-slot="{&quot;home_view&quot;:&quot;content&quot;,&quot;inc_name&quot;:&quot;+Range&quot;,&quot;inc_syntax&quot;:&quot;+Range|content&quot;}" style="" class="card-slot missing-view ALL ALL_PLUS TYPE-basic LTYPE_RTYPE-metric-basic RIGHT-range TYPE_PLUS_RIGHT-metric-range"><a class="slotter missing-content" rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+Range?view=new">Add <span class="card-title">Jedi<span class="joint">+</span>disturbances in the Force<span class="joint">+</span>Range</span></a></div></h5> </div> </div> </div> <!--Main title and stuff--> <div class="col-md-8 metric-details-header"> <div class="row clearfix "> <div class="col-md-1"> <div id="Jedi+disturbances_in_the_Force+*vote_count" data-card-id="2451" data-card-name="Jedi+disturbances in the Force+*vote count" data-slot="{&quot;home_view&quot;:&quot;titled&quot;,&quot;inc_name&quot;:&quot;+*vote count&quot;,&quot;inc_syntax&quot;:&quot;+*vote count&quot;}" style="" class="card-slot titled-view ALL ALL_PLUS TYPE-basic RSTAR LTYPE_RTYPE-metric-number RIGHT-Xvote_count TYPE_PLUS_RIGHT-metric-Xvote_count SELF-jedi-disturbance_in_the_force-Xvote_count"><div class="menu-slot nodblclick"><div class="vertical-card-menu card-menu show-on-hover"><div class="btn-group slotter card-slot pull-right"><a rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+*vote_count?slot%5Bhome_view%5D=titled&amp;view=vertical_menu"><span class="glyphicon glyphicon-edit " aria-hidden="true"></span></a></div></div> <div class="modal fade" role="dialog" id="modal-jedi-disturbance_in_the_force-Xvote_count"><div class="modal-dialog"><div class="modal-content"></div></div></div></div> <div class="card-header "> <div class="card-header-title "> <span class="card-title">Jedi<span class="joint">+</span>disturbances in the Force<span class="joint">+</span>*vote count</span> </div> </div> <div class="card-body card-content ALL ALL_PLUS TYPE-basic RSTAR LTYPE_RTYPE-metric-number RIGHT-Xvote_count TYPE_PLUS_RIGHT-metric-Xvote_count SELF-jedi-disturbance_in_the_force-Xvote_count"><div class="vote-count">0</div></div> </div> </div> <div class="col-md-11"> <div class="name row"> <a class="inherit-anchor" href="Jedi+disturbances_in_the_Force"> disturbances in the Force </a> </div> <div class="row"> <div class="metric-designer-info"> <a href="/Jedi+contribution"> <div><small class="text-muted">Designed by</small></div> <div><img src="/files/~2155/small." alt="Small" /></div> <div><h3>Jedi</h3></div> </a> </div> </div> </div> </div> </div> </div> <br> <!--Question container--> <div class="row question-container"> <div class="row-icon"> <i class="fa fa-question"></i> </div> <div class="row-data"> <small>Question</small> <div id="Jedi+disturbances_in_the_Force+Question" data-card-id="null" data-card-name="Jedi+disturbances in the Force+Question" data-slot="{&quot;home_view&quot;:&quot;content&quot;,&quot;inc_name&quot;:&quot;+Question&quot;,&quot;inc_syntax&quot;:&quot;+Question|content&quot;}" style="" class="card-slot missing-view ALL ALL_PLUS TYPE-basic LTYPE_RTYPE-metric-basic RIGHT-question TYPE_PLUS_RIGHT-metric-question"><a class="slotter missing-content" rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+Question?view=new">Add <span class="card-title">Jedi<span class="joint">+</span>disturbances in the Force<span class="joint">+</span>Question</span></a></div> </div> </div> </div> </div> <div class="row metric-info"> <!--Ratings and company list --> <div class="col-md-6 rate border-right"> <div class="row"><div id="Jedi+disturbances_in_the_Force+right_sidebar" data-card-id="null" data-card-name="Jedi+disturbances in the Force+right sidebar" data-slot="{&quot;home_view&quot;:&quot;titled&quot;,&quot;inc_name&quot;:&quot;+right sidebar&quot;,&quot;inc_syntax&quot;:&quot;+right sidebar&quot;}" style="" class="card-slot titled-view ALL ALL_PLUS TYPE-html LTYPE_RTYPE-metric-basic RIGHT-right_sidebar TYPE_PLUS_RIGHT-metric-right_sidebar"><div class="menu-slot nodblclick"><div class="vertical-card-menu card-menu show-on-hover"><div class="btn-group slotter card-slot pull-right"><a rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+right_sidebar?slot%5Bhome_view%5D=titled&amp;view=vertical_menu"><span class="glyphicon glyphicon-edit " aria-hidden="true"></span></a></div></div> <div class="modal fade" role="dialog" id="modal-jedi-disturbance_in_the_force-right_sidebar"><div class="modal-dialog"><div class="modal-content"></div></div></div></div> <div class="card-header "> <div class="card-header-title "> <span class="card-title">Jedi<span class="joint">+</span>disturbances in the Force<span class="joint">+</span>right sidebar</span> </div> </div> <div class="card-body card-content ALL ALL_PLUS TYPE-html LTYPE_RTYPE-metric-basic RIGHT-right_sidebar TYPE_PLUS_RIGHT-metric-right_sidebar"><div class="col-md-12 text-center"> <div class="btn-group" role="group" aria-label="..."> <a class="btn btn-default slotter" href='/new/metric_value?layout=modal&slot[metric]=Jedi%2Bdisturbances+in+the+Force' data-toggle='modal' data-target='#modal-main-slot'> <span class="fa fa-plus"></span> Add new value </a> <a class="btn btn-default" href='/new/source?layout=wikirate%20layout'> <span class="fa fa-arrow-circle-o-down"></span> Import </a> <a class="btn btn-default slotter" href='/import_metric_values?layout=modal' data-toggle='modal' data-target='#modal-main-slot'> Help <small>(how to)</small> </a> </div> <!-- #year select|editor --> </div> <div class="col-md-12 form-horizontal" style="display:none"> <div class="form-group"> <!-- show year once filter is done --> </div> </div> <div class="yinyang-list"> <div id="Jedi+disturbances_in_the_Force+all_values" data-card-id="2378" data-card-name="Jedi+disturbances in the Force+all values" data-slot="{&quot;name_context&quot;:&quot;jedi,disturbance_in_the_force&quot;,&quot;home_view&quot;:&quot;titled&quot;,&quot;inc_name&quot;:&quot;_left+all_values&quot;,&quot;inc_syntax&quot;:&quot;_left+all_values| hide:title;|content;structure:metric company item&quot;,&quot;items&quot;:{&quot;view&quot;:&quot;content&quot;,&quot;structure&quot;:&quot;metric company item&quot;},&quot;hide&quot;:&quot;title&quot;}" style="" class="card-slot titled-view ALL ALL_PLUS TYPE-basic LTYPE_RTYPE-metric-basic RIGHT-all_value TYPE_PLUS_RIGHT-metric-all_value SELF-jedi-disturbance_in_the_force-all_value"><div class="menu-slot nodblclick"><div class="vertical-card-menu card-menu show-on-hover"><div class="btn-group slotter card-slot pull-right"><a rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+all_values?slot%5Bhome_view%5D=titled&amp;view=vertical_menu"><span class="glyphicon glyphicon-edit " aria-hidden="true"></span></a></div></div> <div class="modal fade" role="dialog" id="modal-jedi-disturbance_in_the_force-all_value"><div class="modal-dialog"><div class="modal-content"></div></div></div></div> <div class="card-header "> <div class="card-header-title "> </div> </div> <div class="card-body card-content ALL ALL_PLUS TYPE-basic LTYPE_RTYPE-metric-basic RIGHT-all_value TYPE_PLUS_RIGHT-metric-all_value SELF-jedi-disturbance_in_the_force-all_value"> <div class='yinyang-row column-header'> <div class='company-item value-item'> <a class='header metric-list-header slotter' data-remote='true' href='/Jedi+disturbances_in_the_Force+all_values?item=content&offset=0&limit=20&sort_order=asc&sort_by=company_name'> Companies <i class="fa fa-sort"></i> </a> <a class='data metric-list-header slotter' data-remote='true' href='/Jedi+disturbances_in_the_Force+all_values?item=content&offset=0&limit=20&sort_order=asc&sort_by=value'> Values <i class="fa fa-sort-desc"></i> </a> </div> </div> <div class="search-result-list"> <div class="search-result-item item-content"> <div id="Jedi+disturbances_in_the_Force+Death_Star" data-card-id="2365" data-card-name="Jedi+disturbances in the Force+Death_Star" data-slot="{&quot;name_context&quot;:&quot;jedi,disturbance_in_the_force&quot;,&quot;home_view&quot;:&quot;content&quot;,&quot;structure&quot;:&quot;metric company item&quot;}" style="" class="card-slot content-view card-content STRUCTURE-metric_company_item ALL ALL_PLUS TYPE-html LTYPE_RTYPE-metric-company RIGHT-death_star TYPE_PLUS_RIGHT-metric-death_star SELF-jedi-disturbance_in_the_force-death_star"><div class="yinyang-row"> <div class="company-item value-item"> <div class="header"> <a href="/Death_Star" class="inherit-anchor hidden-xs"> <div class="logo"> <img src="/files/~2155/small." alt="Small" /> </div> </a> <a href="/Death_Star" class="inherit-anchor"> <div class="name"> Death Star </div> </a> </div> <div class="data metric-details-toggle" data-append="metric_details_company_header"> <div class="data-item"> <span data-year="1977" data-value="yes" > <span class="metric-year"> 1977 = </span> <span class="metric-value"><a data-target="#modal-main-slot" data-toggle="modal" href="/Jedi+disturbances_in_the_Force+Death_Star+1977?layout=modal&amp;slot%5Boptional_horizontal_menu%5D=hide&amp;slot%5Bshow%5D=menu">yes</a></span> <span class="metric-unit"> </span> </span> </div> </div> <div class="details"> </div> </div> </div></div> </div> </div> </div> </div> </div> </div> </div></div> </div> <!--Rightside --> <div class="col-md-6 wiki"> <!--tabs--> <div role="tabpanel" class="tabbable"><ul class="nav nav-tabs" role="tablist"><li role="presentation" class="active"><a data-url="/Jedi+disturbances_in_the_Force?view=details_tab" role="tab" data-toggle="tab" href="#jedi-disturbance_in_the_force-detail"><span class="card-title">Details</span></a></li><li role="presentation"><a data-url="/Jedi+disturbances_in_the_Force?view=source_tab" class="load" role="tab" data-toggle="tab" href="#jedi-disturbance_in_the_force-source"><span class="card-title">Sources</span></a></li><li role="presentation"><a data-url="/Jedi+disturbances_in_the_Force?view=discussion_tab" class="load" role="tab" data-toggle="tab" href="#jedi-disturbance_in_the_force-i_class_fa_fa_comment_i_discussion"><span class="card-title"><i class="fa fa-comment"></i> Discussion</span></a></li><li role="presentation"><a data-url="/Jedi+disturbances_in_the_Force?view=scores_tab" class="load" role="tab" data-toggle="tab" href="#jedi-disturbance_in_the_force-score"><span class="card-title">Scores</span></a></li></ul> <div class="tab-content"><div role="tabpanel" id="jedi-disturbance_in_the_force-detail" class="tab-pane active"><div id="Jedi+disturbances_in_the_Force+About" data-card-id="null" data-card-name="Jedi+disturbances in the Force+About" data-slot="{&quot;home_view&quot;:&quot;titled&quot;,&quot;title&quot;:&quot;About&quot;}" style="" class="card-slot missing-view ALL ALL_PLUS TYPE-basic LTYPE_RTYPE-metric-basic RIGHT-about TYPE_PLUS_RIGHT-metric-about"><a class="slotter missing-titled" rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+About?view=new">Add <span class="card-title">About</span></a></div> <div id="Jedi+disturbances_in_the_Force+Methodology" data-card-id="null" data-card-name="Jedi+disturbances in the Force+Methodology" data-slot="{&quot;home_view&quot;:&quot;titled&quot;,&quot;title&quot;:&quot;Methodology&quot;}" style="" class="card-slot missing-view ALL ALL_PLUS TYPE-basic LTYPE_RTYPE-metric-basic RIGHT-methodology TYPE_PLUS_RIGHT-metric-methodology"><a class="slotter missing-titled" rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+Methodology?view=new">Add <span class="card-title">Methodology</span></a></div> <div id="Jedi+disturbances_in_the_Force+value_type" data-card-id="2362" data-card-name="Jedi+disturbances in the Force+value type" data-slot="{&quot;home_view&quot;:&quot;titled&quot;,&quot;title&quot;:&quot;Value Type&quot;}" style="" class="card-slot titled-view ALL ALL_PLUS TYPE-pointer LTYPE_RTYPE-metric-pointer RIGHT-value_type TYPE_PLUS_RIGHT-metric-value_type SELF-jedi-disturbance_in_the_force-value_type"><div class="menu-slot nodblclick"><div class="vertical-card-menu card-menu show-on-hover"><div class="btn-group slotter card-slot pull-right"><a rel="nofollow" data-remote="true" href="/Jedi+disturbances_in_the_Force+value_type?slot%5Bhome_view%5D=titled&amp;view=vertical_menu"><span class="glyphicon glyphicon-edit " aria-hidden="true"></span></a></div></div> <div class="modal fade" role="dialog" id="modal-jedi-disturbance_in_the_force-value_type"><div class="modal-dialog"><div class="modal-content"></div></div></div></div> <div class="card-header "> <div class="card-header-title "> <span class="card-title">Value Type</span> </div> </div> <div class="card-body card-content ALL ALL_PLUS TYPE-pointer LTYPE_RTYPE-metric-pointer RIGHT-value_type TYPE_PLUS_RIGHT-metric-value_type SELF-jedi-disturbance_in_the_force-value_type"><div class="pointer-list"><div class="pointer-item item-name">Categorical</div></div></div> </div></div><div role="tabpanel" id="jedi-disturbance_in_the_force-source" class="tab-pane"></div><div role="tabpanel" id="jedi-disturbance_in_the_force-i_class_fa_fa_comment_i_discussion" class="tab-pane"></div><div role="tabpanel" id="jedi-disturbance_in_the_force-score" class="tab-pane"></div></div></div> </div> </div> </div> </div>
HTML
end

