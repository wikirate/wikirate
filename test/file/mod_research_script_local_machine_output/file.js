// script_citation.js.coffee
(function(){var n,a,r,i,e,o,c,t,u,s,d;$.extend(wikirate,{showSourceTab:function(){return $("#research-details .nav-tabs li:first a").removeClass("d-none").tab("show")},toggleCitation:function(e,t){return 0===a().length?alert("Can't change citations. Answer is not in edit mode."):s(t,c(e))},hideAlreadyCited:function(){return a().each(function(){var e;return e=$(this).find(".bar-view").data("card-id"),o(e).hide()})},previewSource:function(e){var t;return wikirate.showSourceTab("source"),(t=$(".preview-view")).empty(),wikirate.loader(t).add(),d(t,e)},activateSourceBar:function(e){var t;return(t=$(".cited-sources").find(".bar-view")).removeClass("active"),(e?e.closest(".bar-view"):$(t[0])).addClass("active")}},a=function(){return $(".left_research_side-view .cited-sources")},c=function(e){return $(e).closest("._cite-bar").data("card-id")},s=function(e,t){return"cite"===e?r(t):"uncite"===e?u(t):void 0},n=function(e){var t,r,i;if(t="Please confirm that you wish to cite this source for a "+(r=$("form.answer-form > input#success_year").val())+" answer (and add "+r+" to the years covered by this source).",0<(i=e.data("year")||[]).length){if(i.includes(r))return!0;t="The source you are citing is currently listed as a source for "+i.sort().toString()+". "+t}return window.confirm(t)},i=function(e){return $("form ._cite-bar[data-card-id='"+e+"']")},o=function(e){return $("#research-details .source-list > ._cite-bar[data-card-id='"+e+"']")},r=function(e){var t,r,i;return i=o(e),!!n(i)&&(t=i.clone(!0),i.hide(),-1<(r=a()).text().search("None")&&r.empty(),r.append(t),!0)},u=function(e){var t;return i(e).remove(),((t=a()).is(":empty")||""===t.text().trim())&&t.text("None"),o(e).show()},d=function(e,t){var r;return r=decko.slotPath(t+"?view=preview"),e.reloadSlot(r)},e=function(e){var t;return t=e.slot().data("card-link-name"),window.open(decko.path(t))}),t=".slot_machine-view .TYPE-answer.titled-view .source-preview-link",$(document).ready(function(){if($("body").on("click",".bar.TYPE-task",function(){return e($(this))}),$("body").on("click",".bar.TYPE-task a",function(){return e($(this).closest(".bar")),!1}),$("body").on("click","._cite-button",function(){return wikirate.toggleCitation(this,"cite")}),$("body").on("click","._uncite-button",function(){return wikirate.toggleCitation(this,"uncite")}),$("body").on("click",t,function(e){return wikirate.previewSource($(this).slot().data("card-name")),wikirate.activateSourceBar($(this)),e.preventDefault()}),$("body").on("ajax:error","#research_page-view_source > .card-slot",function(){return $(this).find(".loader-anime").remove()}),$(t).exists())return wikirate.activateSourceBar(null)}),decko.slotReady(function(e){if(e.find(".TYPE-answer.source_selector-view")[0])return wikirate.hideAlreadyCited()})}).call(this);
// script_research.js.coffee
(function(){var e,n,o,r,c,a,i;decko.slotReady(function(t){return t.find(".RIGHT-unknown input[type=checkbox]").on("change",function(){if($(this).is(":checked"))return e($(this).slot())}),t.find(".RIGHT-value").find("input, select").on("change",function(){return i(t,$(this).val())})}),e=function(t){var e;return e=t.find(".card-editor.RIGHT-value .content-editor"),o(e)},o=function(t){var e;return(e=t.find("select"))[0]?e.val(null).change():n(t)},n=function(t){return $.each(t.find("input:not(.current_revision_id)"),function(){var t;return"text"===(t=$(this)).prop("type")?t.val(null):t.prop("checked",!1)})},i=function(t,e){var n;if(""!==(e=e.toString()))return n=t.find(".RIGHT-unknown input[type=checkbox]"),$(n).prop("checked",a(e))},a=function(t){return"unknown"===t.toLowerCase()},decko.slotReady(function(t){return t.find("input._research-select").autocomplete({select:function(t,e){var n,o;return o=(n=$(t.target)).data("url"),o+=o.match(/\?/)?"&":"?",o+=n.data("key")+"="+encodeURIComponent(e.item.value),n.reloadSlot(o)}}),t.find("._html-select:not(.loaded)").each(function(){return $(this).addClass("loaded"),$(this).select2({minimumInputLength:0,maximumSelectionSize:1,dropdownAutoWidth:"true",width:"100%",templateResult:r,templateSelection:c,escapeMarkup:function(t){return t},containerCssClass:"html-select2",dropdownCssClass:"html-select2"})})}),r=function(t){var e;return t.loading?t.text:(e=$(t.element).data("option-selector"),$(e).html())},c=function(t){var e;return e=$(t.element).data("selected-option-selector"),$(e).html()},$(document).ready(function(){return $("body").on("submit","form.answer-form",function(t){var e;if(1===(e=$(t.target)).find("#card_subcards__related_company_content").length&&":research_page"!==e.find("#success_id").val())return e.find("#success_id").val("_left")}),$("body").on("select2:select","._html-select",function(t){var e;return e=$(t.params.data.element).data("url"),window.location=decko.path(e)}),$("body").on("click","._methodology-tab",function(){return $("#research-details .nav-tabs > li:nth-child(2) a").tab("show")}),$("body").on("click","._reset_sourcebox",function(){return $(this).hide(),$("#source_search_term").val("")})})}).call(this);