// script_citation.js.coffee
(function(){var t,i,o,r,n,a,e,c,s,u,d,l,f,v,h,w;u=function(){return $("#research-details .nav-tabs li:first a").removeClass("d-none").tab("show")},f=function(e,t){return 0===o().length?alert("Can't change citations. Answer is not in edit mode."):h(t,d(e))},a=function(){return o().each(function(){var e;return e=$(this).find(".bar-view").data("card-id"),c(e).hide()})},s=function(e){var t;return u("source"),(t=$(".preview-view")).empty(),wikirate.loader(t).add(),w(t,e)},t=function(e){var t;return(t=$(".cited-sources").find(".bar-view")).removeClass("active"),(e?e.closest(".bar-view"):$(t[0])).addClass("active")},o=function(){return $(".left_research_side-view .cited-sources")},d=function(e){return $(e).closest("._cite-bar").data("card-id")},h=function(e,t){return"cite"===e?r(t):"uncite"===e?v(t):void 0},i=function(e){var t,r,n;if(t="Please confirm that you wish to cite this source for a "+(r=$("form.answer-form > input#success_year").val())+" answer (and add "+r+" to the years covered by this source).",0<(n=e.data("year")||[]).length){if(n.includes(r))return!0;t="The source you are citing is currently listed as a source for "+n.sort().toString()+". "+t}return window.confirm(t)},n=function(e){return $("form ._cite-bar[data-card-id='"+e+"']")},c=function(e){return $("#research-details .source-list > ._cite-bar[data-card-id='"+e+"']")},r=function(e){var t,r,n;return n=c(e),!!i(n)&&(t=n.clone(!0),n.hide(),-1<(r=o()).text().search("None")&&r.empty(),r.append(t),!0)},v=function(e){var t;return n(e).remove(),((t=o()).is(":empty")||""===t.text().trim())&&t.text("None"),c(e).show()},w=function(e,t){var r;return r=decko.slotPath(t+"?view=preview"),e.reloadSlot(r)},e=function(e){var t;return t=e.slot().data("card-link-name"),window.open(decko.path(t))},l=".slot_machine-view .TYPE-answer.titled-view .source-preview-link",$(document).ready(function(){if($("body").on("click",".bar.TYPE-task",function(){return e($(this))}),$("body").on("click",".bar.TYPE-task a",function(){return e($(this).closest(".bar")),!1}),$("body").on("click","._cite-button",function(){return f(this,"cite")}),$("body").on("click","._uncite-button",function(){return f(this,"uncite")}),$("body").on("click",l,function(e){return s($(this).slot().data("card-name")),t($(this)),e.preventDefault()}),$("body").on("ajax:error","#research_page-view_source > .card-slot",function(){return $(this).find(".loader-anime").remove()}),$(l).exists())return t(null)}),decko.slotReady(function(e){if(e.find(".TYPE-answer.source_selector-view")[0])return a()})}).call(this);
// script_research.js.coffee
(function(){var e,n,o,r,c,a,i;decko.slotReady(function(t){return t.find(".RIGHT-unknown input[type=checkbox]").on("change",function(){if($(this).is(":checked"))return e($(this).slot())}),t.find(".RIGHT-value").find("input, select").on("change",function(){return i(t,$(this).val())})}),e=function(t){var e;return e=t.find(".card-editor.RIGHT-value .content-editor"),o(e)},o=function(t){var e;return(e=t.find("select"))[0]?e.val(null).change():n(t)},n=function(t){return $.each(t.find("input:not(.current_revision_id)"),function(){var t;return"text"===(t=$(this)).prop("type")?t.val(null):t.prop("checked",!1)})},i=function(t,e){var n;if(""!==(e=e.toString()))return n=t.find(".RIGHT-unknown input[type=checkbox]"),$(n).prop("checked",a(e))},a=function(t){return"unknown"===t.toLowerCase()},decko.slotReady(function(t){return t.find("input._research-select").autocomplete({select:function(t,e){var n,o;return o=(n=$(t.target)).data("url"),o+=o.match(/\?/)?"&":"?",o+=n.data("key")+"="+encodeURIComponent(e.item.value),n.reloadSlot(o)}}),t.find("._html-select:not(.loaded)").each(function(){return $(this).addClass("loaded"),$(this).select2({minimumInputLength:0,maximumSelectionSize:1,dropdownAutoWidth:"true",width:"100%",templateResult:r,templateSelection:c,escapeMarkup:function(t){return t},containerCssClass:"html-select2",dropdownCssClass:"html-select2"})})}),r=function(t){var e;return t.loading?t.text:(e=$(t.element).data("option-selector"),$(e).html())},c=function(t){var e;return e=$(t.element).data("selected-option-selector"),$(e).html()},$(document).ready(function(){return $("body").on("submit","form.answer-form",function(t){var e;if(1===(e=$(t.target)).find("#card_subcards__related_company_content").length&&":research_page"!==e.find("#success_id").val())return e.find("#success_id").val("_left")}),$("body").on("select2:select","._html-select",function(t){var e;return e=$(t.params.data.element).data("url"),window.location=decko.path(e)}),$("body").on("click","._methodology-tab",function(){return $("#research-details .nav-tabs > li:nth-child(2) a").tab("show")}),$("body").on("click","._reset_sourcebox",function(){return $(this).hide(),$("#source_search_term").val("")})})}).call(this);